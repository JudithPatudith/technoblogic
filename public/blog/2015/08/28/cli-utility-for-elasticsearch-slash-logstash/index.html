
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>logasurous: A CLI Utility for Elasticsearch / Logstash - What we observe is not nature itself, but nature exposed to our method of questioning</title>
  <meta name="author" content="Jeff">

  
  <meta name="description" content="logasurous: A CLI Utility for Elasticsearch / Logstash written Like most operations teams, at SRC:CLR we&rsquo;re offloading our logs to a &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="httpL://www.jeffmalnick.com/blog/2015/08/28/cli-utility-for-elasticsearch-slash-logstash">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="What we observe is not nature itself, but nature exposed to our method of questioning" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  

</head>

  <body>
    <a href="/" class="home-icon">
      <img src="/images/home.png"/>
    </a>

    <article role="article" class="full-single-article">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        <h1>logasurous: A CLI Utility for Elasticsearch / Logstash</h1>
        <div class="meta">
          written 








  



<time datetime="2015-08-28T12:19:11-07:00" pubdate data-updated="true"></time>
          


        </div>
        <p><img style="float: center;" src="https://dl.dropboxusercontent.com/u/77193293/logasaurous.png"></p>

<p>Like most operations teams, at SRC:CLR we&rsquo;re offloading our logs to a aggregated log solution. We use the popular ELK (Elasticsearch, logstash, kibana). I love this solution, but when it comes to simply copying and pasting log data from Kibana, things get messy. When our developers need to get data quickly, it would be easier to have a CLI utility that can do the same queries than having to open a browser and screen grab from Kibana.</p>

<h2>So we wrote <a href="https://github.com/sourceclear/logasaurous">logasurous</a></h2>

<p>logasurous runs in realtime, just like Kibana, on similar searches. This is great if your workflow is primarily in the console, and you&rsquo;re using Kibana mainly for query operations. You can use your tmux copy/paste shortcuts to grab data quickly. Queries are just as fast.</p>

<p>logasurous was written in Go, so you know it&rsquo;s performant and lightweight.</p>

<h2>How it works</h2>

<p>First, download and build the go binary:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone https://github.com/malnick/logasurous
</span><span class='line'><span class="nb">cd </span>logasurous
</span><span class='line'>go build loga.go
</span></code></pre></td></tr></table></div></figure>


<p>Configure the config.yaml:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>vi config.yaml
</span></code></pre></td></tr></table></div></figure>


<p>Update your Elasticsearch URI, and add some service abstractions to the &lsquo;define&rsquo; section.</p>

<p>Execute your first query:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>./loga -s my_example_service
</span></code></pre></td></tr></table></div></figure>


<h4>Add some queries to config.yaml</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="nn">---</span>
</span><span class='line'>  <span class="c1"># Defined services</span>
</span><span class='line'>  <span class="l-Scalar-Plain">define</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">my_example_service</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">some_value AND another_value</span>
</span><span class='line'>    <span class="l-Scalar-Plain">webhooks_frontend</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">webhooks AND haproxy</span>
</span><span class='line'><span class="nn">...</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">./loga -s webhooks_frontend</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Do a defined query on the CLI</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">./loga -d &quot;some_value AND another_value&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Something is broken</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">./loga -d my_query -v</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Override the sync and depth interval</h4>

<p>Sync interval = time in seconds to refresh the logs. Default: 5 seconds.
Sync depth = time in minutes to go back in the ES datastore. Default: 10 minutes.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">./loga -d my_query -si 10 -sd 1</span>
</span></code></pre></td></tr></table></div></figure>


<p>^^ Queries logs from the last 1 minute, refreshing every 10 seconds.</p>

<h3>Closing Thoughts</h3>

<p>The great thing about this system is the outputs are &ldquo;${hostname} ${message}&rdquo; which is the main thing we end up sorting by.</p>

<p>Sometimes we just run a search on &ldquo;*&rdquo; when new services come up, and we keep an eye out for errors.</p>

<p>With loga, we can execute this on the CLI:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">loga -d &quot;*&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then when we get a stack trace, we can see the host(s) that the stack trace occured and update our query:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">loga -d &quot;\&quot;host-name-internal\&quot;&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can also search back to the stacktrace if it occured more than 10 minutes ago:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">loga -sd 20 -d &quot;\&quot;host-name-internal\&quot;&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>That will dump the last 20 minutes of log data, or 500 queries in asending order.</p>

<p>We love Kibana, but sometimes it&rsquo;s just faster to have a CLI utility to do the mundane things. We really like this tool, and we hope you will to. If you have any suggestions, please reach out malnick at google mail dot com.</p>


        <hr class="divider-short"/>

        
      </div>
    </div>
  </div>
</article>

<hr class="divider-short"/>

<div class="archive-link">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        
          <a class="pull-left" href="/blog/2015/08/13/version-management-in-soa/" title="Previous Post: Version Management in SOA">&laquo; Previous: Version Management in SOA</a>
        

        
      </div>
    </div>
  </div>
</div>

    <footer id="footer" class="her-row">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
  <a href="/"><h4>Home</h4></a>
</div>

<div class="col-md-2">
  <div class="social-icon-list">
    
    <a href="https://twitter.com/8bitsofsketch"><img src="/images/glyphicons_social_31_twitter.png"/></a>
    

    
    <a href="https://github.com/malnick"><img src="/images/glyphicons_social_21_github.png"/></a>
    

    

    
    <a href="mailto:malnick@gmail.com"><img src="/images/glyphicons_social_39_e-mail.png"/></a>
    
  </div>
</div>

<div class="pull-right">
  <h4>Powered by <a href="http://octopress.org/">Octopress</a>. Designed by <a href="http://AdrianArtiles.com">Adrian Artiles</a>.</h4>
</div>


    </div>
  </div>
</footer>

    
  </body>
</html>
