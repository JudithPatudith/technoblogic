
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>Logging Analytics  | JP</title>

<meta name="author" content="Jeff"> 

<meta name="description" content="See subtitle."> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="JP" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">JP</a></h1>
<h4>a techy blog</h4>
<nav id="main-nav"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/about">About</a></li>
	<li><a href="/blog/resume">Resume</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/about">About</a></li>
	<li><a href="/blog/resume">Resume</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:httpL://www.jeffmalnick.com">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">Logging Analytics</h2>
	<div class="entry-content"><p>What’s the first line of action when dealing with a service that is down? Logs.</p>

<p>You can <code>ps ef</code>, <code>netstat aux</code> all day long but the big piece of information cake always lies in the log data. Log data carries the weight of information about your services, whether it’s a Spring Boot micro service powering a small piece of your backend platform or the NGINX and auth logs that convey what is happening on the opposite end of your application stack.</p>

<p>Whatever the situation may be, logs are always the files we end up tailing to figure out what is happening and why.</p>

<h2>Why tailing sucks</h2>

<p>True story: <code>grep -ir 404 * | wc -l</code> or <code>grep -irl 404 *</code> or <code>grep -r 404 * | sort | uniq -c</code></p>

<p>Sure, you might have some good feedback from this. Sure, you can plug this into a tool like nagios to alert you when things hit the fan.</p>

<p>But, it’s missing a critical piece: visualization.</p>

<p>You can’t <strong>see</strong> the log data on a time-based graph; you can’t correlate it to large logging events based on message type, log path or node. You’re only aggregating a single log at a time, and the information</p>

<h2>How SRC:CLR Tracks Logging Data</h2>

<p>At SRC:CLR we use Logstash, Redis, Elasticsearch and Kibana to capture log data from various services that we use including our Sping Boot micro service framework. The overall design looks like this:</p>

<p><img src="http://michael.bouvy.net/blog/wp-content/uploads/2013/11/logstach-archi1.png" alt="aggregation" /></p>

<p>Of course, this entire deployment is brought to you by Puppet Enterprise, and no blog post from me would be complete with out a <a href="https://github.com/sourceclear/puppet-kibana">shameless plug for some new module we wrote to automate this it</a>.</p>

<p>As you can tell, we’re using Kibana 4.0.0 (as of this post, 4.0.1 is out and IS amazing but we’re not using it quite yet). Kibana 4x ships with it’s own server, so there’s no need to frontend it with NGINX or Apache anymore. However, I highly recommend at minimum a local NGINX reverse proxy so you can DNS the node and connect on 80 or 443 if it’s public-facing.</p>

<h3>Logstash Agent Configuration</h3>

<p>In our role for a given node, lets say a backend node that would be running our micro services, I can simply add some logstash configuration:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="ss">roles</span><span class="p">:</span><span class="ss">:backend_services</span> <span class="p">{</span>
</span><span class='line'><span class="err">…</span>
</span><span class='line'>  <span class="c1"># Logstash for services</span>
</span><span class='line'>    <span class="k">class</span> <span class="p">{</span> <span class="o">::</span><span class="ss">profiles</span><span class="p">:</span><span class="ss">:logstash</span><span class="o">::</span><span class="n">backend_services</span><span class="p">:</span>
</span><span class='line'>        <span class="n">redis_logstash_host</span> <span class="o">=&gt;</span> <span class="err">‘</span><span class="n">our</span><span class="o">-</span><span class="n">redis</span><span class="o">-</span><span class="n">aggregator</span><span class="o">.</span><span class="n">ourdomain</span><span class="o">.</span><span class="n">com</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="err">…</span>
</span><span class='line'><span class="c1"># More configuration</span>
</span></code></pre></td></tr></table></div></figure>


<p>And then our backend services profile for logstash, we do something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="ss">profiles</span><span class="p">:</span><span class="ss">:logstash</span><span class="o">::</span><span class="n">backend_services</span> <span class="p">(</span><span class="vg">$redis_logstash_host</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="p">{</span> <span class="s1">&#39;logstash&#39;</span><span class="p">:</span>
</span><span class='line'>        <span class="n">package_url</span> <span class="o">=&gt;</span> <span class="s1">&#39;https://download.elasticsearch.org/logstash/logstash/packages/debian/logstash_1.4.2-1-2c0f5a1_all.deb&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="ss">logstash</span><span class="p">:</span><span class="ss">:configfile</span> <span class="p">{</span> <span class="s1">&#39;output_redis&#39;</span><span class="p">:</span>
</span><span class='line'>        <span class="n">content</span> <span class="o">=&gt;</span> <span class="n">template</span><span class="p">(</span><span class="s1">&#39;profiles/logstash/output_redis.erb&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="n">order</span>   <span class="o">=&gt;</span> <span class="mi">20</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="ss">logstash</span><span class="p">:</span><span class="ss">:configfile</span> <span class="p">{</span> <span class="err">‘</span><span class="n">micro_service_one_input</span><span class="err">’</span><span class="p">:</span>
</span><span class='line'>        <span class="n">content</span> <span class="o">=&gt;</span> <span class="n">template</span><span class="p">(</span><span class="err">‘</span><span class="n">profiles</span><span class="o">/</span><span class="n">logstash</span><span class="o">/</span><span class="n">input_micro_service_one</span><span class="o">.</span><span class="n">erb</span><span class="err">’</span><span class="p">),</span>
</span><span class='line'>        <span class="n">order</span>   <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="ss">logstash</span><span class="p">:</span><span class="ss">:configfile</span> <span class="p">{</span> <span class="err">‘</span><span class="n">micro_service_two_input</span><span class="err">’</span><span class="p">:</span>
</span><span class='line'>        <span class="n">content</span> <span class="o">=&gt;</span> <span class="n">template</span><span class="p">(</span><span class="err">‘</span><span class="n">profiles</span><span class="o">/</span><span class="n">logstash</span><span class="o">/</span><span class="n">input_micro_service_two</span><span class="o">.</span><span class="n">erb</span><span class="err">’</span><span class="p">),</span>
</span><span class='line'>        <span class="n">order</span>   <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="err">…</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>$redis_logstash_host</code> simply needs to be available in the variable namespace for the redis output template.</p>

<p>When it comes to logstash, all the magic happens in those templates. For SRC:CLR, we roll with a few basic inputs and outputs in our logstash templates:</p>

<h4>Log Path Input</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># input_micro_service_one.erb</span>
</span><span class='line'><span class="n">input</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">file</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">path</span> <span class="o">=&gt;</span> <span class="err">“</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">service_name</span><span class="o">/</span><span class="n">service_name</span><span class="o">*.</span><span class="n">log</span><span class="err">”</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Redis Output</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">output</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">redis</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">host</span> <span class="o">=&gt;</span> <span class="s2">&quot;&lt;%= @redis_logstash_host %&gt;&quot;</span>
</span><span class='line'>        <span class="n">data_type</span> <span class="o">=&gt;</span> <span class="s2">&quot;list&quot;</span>
</span><span class='line'>        <span class="n">key</span> <span class="o">=&gt;</span> <span class="s2">&quot;logstash&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>ElasticSearch Output</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">output</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">elasticsearch</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">cluster</span> <span class="o">=&gt;</span> <span class="s1">&#39;logstash&#39;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>The Final <code>logstash/conf.d/logstash.conf</code> File</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">input</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">file</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">path</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="err">“</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">service_name</span><span class="o">/</span><span class="n">service_name</span><span class="o">*.</span><span class="n">log</span><span class="err">”</span><span class="o">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">input</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">file</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">path</span> <span class="o">=&gt;</span> <span class="err">“</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">service_name</span><span class="o">/</span><span class="n">service_name</span><span class="o">*.</span><span class="n">log</span><span class="err">”</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">output</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">redis</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">host</span> <span class="o">=&gt;</span> <span class="err">“</span><span class="n">our</span><span class="o">-</span><span class="n">redis</span><span class="o">-</span><span class="n">aggregator</span><span class="o">.</span><span class="n">ourdomain</span><span class="o">.</span><span class="n">com</span><span class="s2">&quot;</span>
</span><span class='line'><span class="s2">        data_type =&gt; &quot;</span><span class="n">list</span><span class="s2">&quot;</span>
</span><span class='line'><span class="s2">        key =&gt; &quot;</span><span class="n">logstash</span><span class="s2">&quot;</span>
</span><span class='line'><span class="s2">    }</span>
</span><span class='line'><span class="s2">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So far, we’ve covered our log pipeline from <code>micro_services_node -&gt; redis_output</code>. What does the configuration for our redis aggregator look like?</p>

<p>It starts, as usual, with the role:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="ss">roles</span><span class="p">:</span><span class="ss">:logging_aggregator</span>  <span class="p">{</span>
</span><span class='line'>    <span class="c1"># First, provision our ELK Stack</span>
</span><span class='line'>    <span class="k">class</span> <span class="p">{</span> <span class="o">::</span><span class="ss">profiles</span><span class="p">:</span><span class="ss">:elasticsearch</span><span class="o">::</span><span class="n">log_aggregator</span><span class="p">:}</span>
</span><span class='line'>    <span class="o">-&gt;</span>
</span><span class='line'>    <span class="k">class</span> <span class="p">{</span> <span class="o">::</span><span class="ss">profiles</span><span class="p">:</span><span class="ss">:kibana</span><span class="o">::</span><span class="ss">basic</span><span class="p">:}</span>
</span><span class='line'>    <span class="o">-&gt;</span>
</span><span class='line'>    <span class="c1"># The logstash node needs to be an indexer reading from redis, dumping into elasticsearch</span>
</span><span class='line'>    <span class="k">class</span> <span class="p">{</span> <span class="o">::</span><span class="ss">profiles</span><span class="p">:</span><span class="ss">:logstash</span><span class="o">::</span><span class="n">redis_indexer</span><span class="p">:}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Also, a basic redis instance</span>
</span><span class='line'>    <span class="kp">include</span> <span class="o">::</span><span class="ss">profiles</span><span class="p">:</span><span class="ss">:redis</span><span class="o">::</span><span class="n">basic</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can probably tell, we’re rolling the entire ELK stack and redis queue on a single node. We can do this because it’s on a c3.3xlarge AWS instance type with it’s own EBS attached volume of 100GB and the logging data is coming from a small-ish stack.</p>

<p>Our logging volume at the time of this post is about 4GB per day, per environment (QA, Prod, etc..). Flushing your elasticsearch indices and backing them up is highly recommended. There are <a href="https://github.com/imperialwicket/elasticsearch-logstash-index-mgmt">various</a> ways to do this sort of thing, but really the end goal is simple: get to 65% of EBS volume, then flush and back up to a persistent source.</p>

<p>I recommend a datastore in your cluster such as MongoDB or tar.gz’s to S3. Either way, it’s amazing how much log data you can generate, and ours is a small infrastructure so your milage will vary.</p>

<p>Eventually you’ll have to tackle the question: do I scale this vertically or horizontally. With elasticsearch in the mix the answer is simple: horizontally. ES has <a href="http://www.elastic.co/guide/en/elasticsearch/guide/current/optimistic-concurrency-control.html">“optimistic concurrency control”</a> and is particularly well suited for clustering.</p>

<p>For Redis, you’ll have to <a href="http://redis.io/topics/cluster-spec">make a personal decision</a>, but I typically prefer a vertical scale, which is why our aggregation node is a c3.2xlarge and will probably grow.</p>

<h3>Logstash Aggregator Configuration</h3>

<p>Finally, we have the logstash aggregator. I’m not going to dive into it’s elasticsearch or redis configuration since <a href="https://github.com/elastic/puppet-elasticsearch">both those</a> tools are well <a href="https://forge.puppetlabs.com/fsalum/redis">documented</a>. Here, we&rsquo;ll focus on the logstash/redis aggregator configuration.</p>

<p>I will however note the importance, again, of using an EBS volume for your ES data!</p>

<p>From the role profile given above, lets take a look at <code>::profiles::logstash::redis_indexer</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="ss">profiles</span><span class="p">:</span><span class="ss">:logstash</span><span class="o">::</span><span class="n">redis_indexer</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="p">{</span> <span class="s1">&#39;logstash&#39;</span><span class="p">:</span>
</span><span class='line'>        <span class="n">package_url</span> <span class="o">=&gt;</span> <span class="s1">&#39;https://download.elasticsearch.org/logstash/logstash/packages/debian/logstash_1.4.2-1-2c0f5a1_all.deb&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># This template contains everything we need to run the indexer on a single host</span>
</span><span class='line'>    <span class="ss">logstash</span><span class="p">:</span><span class="ss">:configfile</span> <span class="p">{</span> <span class="s1">&#39;redis_indexer&#39;</span><span class="p">:</span>
</span><span class='line'>        <span class="n">content</span> <span class="o">=&gt;</span> <span class="n">template</span><span class="p">(</span><span class="s1">&#39;profiles/logstash/redis_indexer.erb&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="n">order</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Where the redis_indexer.erb looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">input</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">redis</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">host</span> <span class="o">=&gt;</span> <span class="s2">&quot;127.0.0.1&quot;</span>
</span><span class='line'>        <span class="n">data_type</span> <span class="o">=&gt;</span> <span class="s2">&quot;list&quot;</span>
</span><span class='line'>        <span class="n">key</span> <span class="o">=&gt;</span> <span class="s2">&quot;logstash&quot;</span>
</span><span class='line'>        <span class="n">codec</span> <span class="o">=&gt;</span> <span class="n">json</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="n">output</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">elasticsearch</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">host</span> <span class="o">=&gt;</span> <span class="s2">&quot;localhost&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">stdout</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">codec</span> <span class="o">=&gt;</span> <span class="n">rubydebug</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You might notice the stdout output in that. The stdout is great for debugging stuff. When you run <code>logstash service start</code> it’ll startup as a daemon and you can <code>tail -f /var/log/logstash.log</code> but I prefer to run it in the foreground when I’m hooking everything up to see all the pretty colors and to drop it into debug mode.</p>

<p>To do this I execute on both the nodes I’m pulling logs from and the log aggregator:</p>

<p><code>/opt/logstash/bin/logstash -f /etc/logstash/conf.d/logstash.conf —debug</code></p>

<p>Once this pipeline is executed you can go ahead and open <code>our-redis-aggregator.ourdomain.com:5601</code> in your browser and start making some fancy graphs:</p>

<p><img src="https://s3.amazonaws.com/srcclr-public/Screen+Shot+2015-03-11+at+10.15.51+AM.png" alt="one" />
<img src="https://s3.amazonaws.com/srcclr-public/Screen+Shot+2015-03-11+at+10.16.26+AM.png" alt="two" /></p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-03-11T21:06:53-07:00" pubdate data-updated="true">Mar 11<span>th</span>, 2015</time></div>
	


	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
<!---	<a class="addthis_counter addthis_pill_style"></a> --->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    Jeff

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>
