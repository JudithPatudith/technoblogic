
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Technoblogic</title>
  <meta name="author" content="Jeff Malnick">

  
  <meta name="description" content="This is a foo post
">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://technoblogic.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Technoblogic" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='https://fonts.googleapis.com/css?family=Noto+Serif:400,700' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Technoblogic</a></h1>
  
    <h2>Musings on DevOps</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  
  
</ul>

<ul class="main-navigation">
  <li><a href="/blog/archives">All Posts</a></li>
  <li><a href="/blog/resume">Resume</a></li>
  <li><a href="https://github.com/malnick">Github</a></li>
  <li><a href="https://www.flickr.com/photos/129457394@N03/">Flickr</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/20/foo/">Foo</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2015-12-20T15:01:43-08:00" pubdate data-updated="true">Dec 20th, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is a foo post</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/06/architecting-an-installer-for-the-data-center-operating-system/">Architecting an Installer for the Data Center Operating System</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2015-12-06T08:48:28-08:00" pubdate data-updated="true">Dec 6th, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><ol>
<li>What is the install challenge</li>
<li>How we started</li>
<li>Current iteration</li>
<li>How we are going to improve it later</li>
<li>Close</li>
</ol>


<p>Mesosphere&rsquo;s Data Center Operating System (DCOS) is a distributed cluster manager and resource scheduler that enables companies to execute their application with high parallelization and availability. The DCOS ecosystem consists of many open source and proprietary tools to manage executing client applications in the cluster. The core utilities are Apache Mesos, Mesos DNS, Mesosphere&rsquo;s Marathon, Nginx, Apache Zookeeper and Zookeeper Exhibitor (FOSS from Netflix). The production-read version of DCOS runs 3-5 Apache Mesos Masters with &lsquo;n&rsquo; number of Apache Mesos Agents.</p>

<p>Properly configuring and installing this suite of tools to large on-premise deployments poses many challenges:</p>

<ol>
<li>Bootstrapping the cluster for high availability</li>
<li>Bootstrapping the cluster from a single target &ldquo;bootstrapping&rdquo; host</li>
<li>Scoping the configuration available to Mesosphere clients</li>
<li>Master discovery configuration</li>
<li>Exhibitor configuration</li>
<li>Continuous integration tests on the actual software that manages DCOS installation</li>
</ol>


<p>Because of the complexity with bootstrapping a highly available cluster from scratch we have to present the end-user with a lot of implementation details and configuration which is often times confusing and sets a barrier to entry to using DCOS.</p>

<p>Traditionally, you can ship software to a node using well-known package managers (Aptitude or Yum). However, DCOS is designed to run on <strong>any</strong> linux distribution, which means we&rsquo;d have to support all the package management repos our potential customers require: Yum, Aptitude, Pacman, Zypper, etc. Furthermore, since this is a distributed cluster, we have to seed each deployment package with site-specific configuration for each part of the DCOS system. This means the package manager would have to include some way for us to configure cluster wide settings for things like Zookeepers&#8217; zoo.cfg file (managed by Exhibitor), Mesos DNS configuration, and other distributed utilities.</p>

<p>In the end, we would have to configure every node in the cluster with our package repo and this site-specific configuration before the DCOS package actually installs. We could use configuration management for this, but in that case we&rsquo;d also have to write Puppet modules, Chef cookbooks, Ansible playbooks and Salt code to name a few, to ensure we cover all the possible customer requirements for installing DCOS at a given site.</p>

<p>This locks us in to managing a package repo per customer (not to mention tests on each built package system) and a given installation method using configuration management. Let&rsquo;s not even begin to talk about the complexity of maintaining those configuration management codebases across multiple versions of the configuration management suite (in other words, customer A is running Puppet 3x, customer B is running Puppet 2x and customer C is running Puppet 4x - good luck keeping that complicated module cross functional across all versions previous and future - and that&rsquo;s for just a single configuration management suite).</p>

<p>In the end, we opted to design an installer that any customer could run, regardless of configuration management implementation or underlying operating system package managers. This installer can easily integrate with existing configuration management systems or install the cluster via SSH to the distributed nodes. It can also walk customers through the often complicated process of configuring the underlying system before it installs with a user-friendly web UI.</p>

<h2>How We Started</h2>

<p>Our first try at the on-premise installer was a CLI tool that automated configuring and building a bootstrap tarball. It used a JSON configuration file that had some drawbacks. Primarily, we use only string-based variables in our configuration file templates, so we required anything other than strings (such as arrays) in the JSON config, had to be strings:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="s2">&quot;variable&quot;</span><span class="err">:</span> <span class="s2">&quot;[\&quot;var1\&quot;,\&quot;var2\&quot;]&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This was obviously less than ideal.</p>

<p>Secondly, the CLI utility required the end-user to have some way to distribute the tarball it created. This left a lot up to the end-user, and was a point of contention.</p>

<p>Lastly, the end user had a lot of configurated exposed to her that was often confusing. The biggest hurdle was sometimes explaining what Exhibitor was, how to configure it, and in some cases why it needed its own Zookeeper quorum to bootstrap the DCOS quorom.</p>

<p>All of these issues pointed towards a major overhaul of this installation process.</p>

<h2>Our Current Iteration</h2>

<h4>User Interface</h4>

<p>On the outset, we wanted to create an installer that had a user interface. This UI would allow us to walk the user through configuring the DCOS cluster. It would also allow us to quickly copy and paste configuration into the UI, and abstract all the complexity of this process to a clean interface.</p>

<h4>Internally Bootstrap Exhibitor</h4>

<p>We also wanted to remove the Exhibitor configuration from the end-user, getting rid of this confusing configuration piece would lower the barrier to entry and solve many of our support calls. Under the hood, we achieve this by writing our own static ensamble for bootstrapping exhibitor. This new backend to exhibitor allowed us to pass it our static master list to the backend, and it writes this, regardless of cluster state, to the zoo.cfg.</p>

<h4>SSH Deploy</h4>

<p>This new installer would also have a deploy option. The deploy option would leverage SSH on the backend to execute preflight checks on the target hosts in the cluster; install the DCOS tarball to the machines; and execute post-flight checks on the target hosts to enure the cluster was in a working state.</p>

<h4>YAML Configuration File</h4>

<p>This new installer levareages a YAML configuration file. The UI walks the user through building this YAML file but the beauty is that we can ship pre-built YAML files with in-line comments. JSON doesn&rsquo;t allow us to put comments in the file, and with that option available we can make more clear what each configuration parameter does without having the end-user touch the UI.</p>

<h4>Configuration Management Integration</h4>

<p>Our previous installer shipped around the installer script, which would pull the tarball from the configuration machine. In this way, it was partially on its way to integrating with configuration management. However, the previous installer did not ship a server to serve that tarball. It was up to the end-user to configure an NGINX, Apache or other server that would allow the script to pull down the tarball from the host machine.</p>

<p>For many systems administrators this was fine, however, for many it was just another barrier to entry. To simplify this process we&rsquo;re now shipping a built in server and an option to execute the CLI mode of the installer with <code>--bootstrap_url</code>.</p>

<p><code>--bootstrap_url</code> exposes a URL on the installer host: <code>http://$INSTALLER_IP:9000/bootstrap</code></p>

<p>With this feature, you can expose the bootstrap URL on the installer host and write a very simple Puppet module, Chef cookbook or Ansible playbook to pull the tarball, extract it to the filesystem and create the required symlinks. This is a far more simple option to management of your configuration management code than building all the current and possible future config files for DCOS. Now it&rsquo;s just three unix-level operations.</p>

<h2>Future Improvements</h2>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/09/05/mantle-encrypted-json-for-the-marathon-api/">Mantle: Encrypted JSON for the Marathon API</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2015-09-05T13:00:32-07:00" pubdate data-updated="true">Sep 5th, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img style="float: center;" src="https://dl.dropboxusercontent.com/u/77193293/mantle.png"></p>

<p><a href="https://github.com/malnick/mantle.git">Mantle</a> is a go utility that wraps the POST process to Mesosphere&rsquo;s Marathon API. Before, users had to store JSON with cleartext environment variables for their Docker container configuration. With Mantle, users can encrypt the values for the &ldquo;env&rdquo; parameters passed to Marathon using asynchronous public/private key pairs. Mantle is designed to allow operations or deployment teams to build user-level key pairs, and give those public keys to the users&#8217; with the most knowledge of the application&rsquo;s configuration. Those users, can then encode the JSON with Mantle via their public keys and let the deployment team review the JSON and have the final private key to decrypt and deploy to Marathon(s) via Mantle.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/09/05/mantle-encrypted-json-for-the-marathon-api/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/08/28/elasticsearch-logstash-cli-utility/">Logasaurus: A CLI Utility for Elasticsearch / Logstash</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2015-08-28T12:19:11-07:00" pubdate data-updated="true">Aug 28th, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img style="float: center;" src="https://dl.dropboxusercontent.com/u/77193293/logasaurus.png"></p>

<p>Like most operations teams, at SRC:CLR we&rsquo;re offloading our logs to an aggregated log solution. We use the popular ELK (Elasticsearch, Logstash, Kibana). I love this solution but when it comes to simply copying and pasting log data from Kibana things get messy. When our developers need to get data quickly it would be easier to have a CLI utility that can do the same queries than having to open a browser and screen grab from Kibana.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/08/28/elasticsearch-logstash-cli-utility/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/08/13/version-management-in-soa/">Version Management in SOA</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2015-08-13T08:47:19-07:00" pubdate data-updated="true">Aug 13th, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Service oriented architectures offer significant increases in agile deployment pipelines. They allow what were traditionally, large, monolithic code bases to be broken down into smaller, more manageable pieces. Instead of diagnosing a single issue that affects the application as a whole, SOA allows developers to troubleshoot smaller, atomic pieces.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/08/13/version-management-in-soa/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/31/a-restful-haproxy-service-abstraction/">A Restful Haproxy Service Abstraction</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2015-07-31T06:05:55-07:00" pubdate data-updated="true">Jul 31st, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A major hurdle of microservices is visibility into the versions of your deployed infrastructure. At SRC:CLR we have 7 different micro services plus our platform that drive our product. These services are deployed as immutable infrastructure, their IP&rsquo;s and configuration is fluid and changing all the time. During a deployment, we might to a canary update of our services, but having to manually query the <code>/info</code> endpoint across &lsquo;n&rsquo; number of nodes, IP addresses, and dynamic management port assignments is error prone and difficult. In order to gain visibility into the currently running services, we wrote a tool that finds available services by querying our frontend and internal loadbalancers for running services, and then queries those running services to get their running versions and display them in a lightweight frontend.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/07/31/a-restful-haproxy-service-abstraction/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/21/weak-dh-ciphers/">Weak Diffe-Helman SSL Ciphers</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2015-07-21T11:32:12-07:00" pubdate data-updated="true">Jul 21st, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>We recently scanned our <code>srcclr.com</code> domain via <a href="https://www.ssllabs.com/">Qualsys</a> SSL Labs scanning suite. When we deployed this site in March (a migration from sourceclear.com to srcclr.com) we had an A+ rating.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/07/21/weak-dh-ciphers/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/14/static-service-provisioning-sucks/">Static Service Provisioning Sucks</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2015-07-14T13:05:01-07:00" pubdate data-updated="true">Jul 14th, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Many tools exist to help automate and orchestrate provisioning servers. Each tool serves a purpose, or is tailored for a specific task. One realization I had not to long ago was that configuration management tools, as a framework, suck at provisioning micro services. I say that at the risk of bringing on the deluge of comments that often accompany such a blunt, over arching statement.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/07/14/static-service-provisioning-sucks/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/17/vertically-scaled-infrastructure/">Vertically Scaled Infrastructure</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2015-06-17T12:48:27-07:00" pubdate data-updated="true">Jun 17th, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>&ldquo;&hellip;but does is scale?&rdquo;</h2>

<p>When it comes to micro-service architectures that&rsquo;s always the big question. You can maintain a solid agile development process, design a micro service architecture, and implement seamless CI to ensure developers can launch code from their local test environment into Prod but if you can&rsquo;t respond to the increase in demand for your product then who cares? Unusable products, no matter how cool, won&rsquo;t get traffic and your company will suffer.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/06/17/vertically-scaled-infrastructure/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/01/automating-spring-boot-micro-service-deployments/">Automating Spring Boot Micro Service Deployments</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2015-05-01T10:05:30-07:00" pubdate data-updated="true">May 1st, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Spring is a java framework that has been around for the better part of a decade. Though some argue it&rsquo;s growing long in the tooth, it&rsquo;s still a standard among large enterprise to smaller startup style web applications. Spring boot is Springs answer to next generation, easy-to-implement, spring setup. Spring boot has a host of advantages over it&rsquo;s legacy counterpart, chef among them packaging up your application in jar file format vs. war file format, embedded tomcat, and the primary topic of this post: resource configuration based on config files found in the classpath.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/05/01/automating-spring-boot-micro-service-deployments/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="2">&larr; Older</a>
    
    <a href="/blog/archives">All Posts</a>
    
  </div>
</div>
<aside class="sidebar">
   
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:technoblogic.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/12/20/foo/">Foo</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/06/architecting-an-installer-for-the-data-center-operating-system/">Architecting an Installer for the Data Center Operating System</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/05/mantle-encrypted-json-for-the-marathon-api/">Mantle: Encrypted JSON for the Marathon API</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/28/elasticsearch-logstash-cli-utility/">Logasaurus: A CLI Utility for Elasticsearch / Logstash</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/13/version-management-in-soa/">Version Management in SOA</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/malnick">@malnick</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'malnick',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

Included file &#8216;asides/twitter.html&#8217; not found in _includes directory
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Jeff Malnick -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<script>
  $(document).ready(function() {  
    var stickyNavTop = $('nav').offset().top;  
      
    var stickyNav = function(){  
      var scrollTop = $(window).scrollTop(); 
      var navHasClassSticky = $('nav').hasClass('sticky');

      if (scrollTop > stickyNavTop && navHasClassSticky) {   
        return true;
      } else if (scrollTop > stickyNavTop) {
        $('nav').hide();
        $('nav').addClass('sticky');
        $('nav').fadeIn('2000');
      } else {  
        $('nav').removeClass('sticky');   
      }  
    };  
      
    stickyNav();  
      
    $(window).scroll(function() {  
      stickyNav();  
    });  
  });  
</script>


</body>
</html>
